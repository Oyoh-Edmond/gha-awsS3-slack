name: Process File and Notify Slack with Bot Token

on:
  workflow_dispatch:
    inputs:
      filename:
        description: 'Enter the name of the file'
        required: true
        default: 'rand.txt'

jobs:
  process-file:
    runs-on: ubuntu-latest
    outputs:
      file-content: ${{ steps.readfile.outputs.content }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Read and echo file content
        id: readfile
        run: |
          content=$(awk '{print "\""$0"\""}' ${{ github.event.inputs.filename }} | paste -sd, -)
          echo "{\"codes\":[$content]}" > codes.json
          echo "::set-output name=content::$(cat codes.json)"

  notify-slack:
    runs-on: ubuntu-latest
    needs: process-file
    if: always()
    steps:
      - name: Send notification to Slack
        uses: slackapi/slack-github-action@v1.26.0
        with:
         SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
         channel: '#gha_interns'
            text: "File processed: ${{ needs.process-file.outputs.file-content }}"
